<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–ª–≥–æ—Å—ã ‚Äî —Ä–µ–π—Ç–∏–Ω–≥–∏</title>
  <link rel="icon" href="./static/logo.png" type="image/png" media="(prefers-color-scheme: light)">
  <link rel="icon" href="./static/logo_neg.png" type="image/png" media="(prefers-color-scheme: dark)">
  <style>
    :root{
      --bg:#0c0f14;--surface:#121621;--muted:#1a1f2b;--text:#e6e6ea;--subtle:#aab1c3;--accent:#6ae3ff;--accent-2:#9bff8a;--radius:16px;--shadow:0 8px 28px rgba(0,0,0,.35);--maxw:1100px;
    }
    body{margin:0;font-family:system-ui, sans-serif;background:var(--bg);color:var(--text);} 
    a{color:var(--accent);text-decoration:none}
    .container{max-width:var(--maxw);margin:0 auto;padding:24px;}
    header{position:sticky;top:0;background:#0c0f14d9;padding:14px 24px;}
    .nav{display:flex;align-items:center;gap:16px;max-width:var(--maxw);margin:0 auto;}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;}
    .logo-badge{display:grid;place-items:center;width:36px;height:36px;border-radius:10px;background:#172033;}
    .spacer{flex:1}
    .btn{padding:8px 12px;border-radius:10px;background:var(--muted);}
    h1{margin:0 0 16px;font-size:20px;color:var(--subtle);font-weight:600}

    .panel{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);}
    .section-title{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.06);color:var(--subtle);font-weight:600;}
    .body{padding:14px 18px}

    table{width:100%;border-collapse:collapse;}
    th,td{padding:10px 12px;text-align:left;}
    th{color:var(--subtle);font-weight:600;font-size:14px;border-bottom:1px solid rgba(255,255,255,.1);}
    td{border-bottom:1px solid rgba(255,255,255,.05);}
    td.score{font-variant-numeric:tabular-nums;}

    th:nth-child(1), td:nth-child(1) { width: 40px; }   /* # */
    th:nth-child(2), td:nth-child(2) { width: auto; }   /* –ò–º—è */
    th:nth-child(3), td:nth-child(3) { width: 80px; }   /* –¢–µ–∫—É—â–∏–π */
    th:nth-child(4), td:nth-child(4) { width: 200px; }  /* –ò—Å—Ç–æ—Ä–∏—è */

    .spark { width:200px; height:40px; }

    footer{color:var(--subtle);font-size:14px;padding:24px 0;text-align:center}
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="logo">
        <div class="logo-badge"><span>üèÜ</span></div>
        <span>–ê–ª–≥–æ—Å—ã</span>
      </div>
      <div class="spacer"></div>
      <a class="btn" href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a class="btn" href="topics.html">üìö –ó–∞–Ω—è—Ç–∏—è</a>
      <a class="btn" href="ratings.html">üèÜ –†–µ–π—Ç–∏–Ω–≥–∏</a>
    </nav>
  </header>

  <main class="container">
    <h1>–ü–µ—Ä—Ñ–æ–º–∞–Ω—Å-—Ä–µ–π—Ç–∏–Ω–≥–∏</h1>
    <section class="panel">
      <div class="body">
        <table id="ratings-table">
          <thead>
            <tr><th>#</th><th>–£—á–∞—Å—Ç–Ω–∏–∫</th><th>–≠–ª–æ</th><th>–ò—Å—Ç–æ—Ä–∏—è</th></tr>
          </thead>
          <tbody>
            <tr><td colspan="4">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <footer>
      ¬© 2025 –ê–ª–≥–æ—Å—ã ‚Äî <a href="https://github.com/Thamgr/algosy" target="_blank">GitHub</a>
    </footer>
  </main>

  <script>
  (function(){
    const GVIZ_URL = "https://docs.google.com/spreadsheets/d/1SBeX7SN7MSNwImvTdxmVAd1oWoa9DkKRGy63ElZtB7w/gviz/tq?tqx=out:json&gid=0";
    const TBODY = document.querySelector('#ratings-table tbody');

    const toNum = v => parseFloat(String(v ?? '').replace(/\u00A0/g,'').replace(/\s/g,'').replace(',', '.'));
    const fmt = n => Number.isFinite(n) ? (Math.abs(n - Math.round(n)) < 1e-6 ? String(Math.round(n)) : n.toFixed(1)) : '‚Äî';

    function buildSparkline(values, w=100, h=48){
      let hasSegment = false;
      for (let i=1;i<values.length;i++){
        if (Number.isFinite(values[i-1]) && Number.isFinite(values[i])) { hasSegment = true; break; }
      }
      if (!hasSegment) return `<svg class="spark" viewBox="0 0 ${w} ${h}"></svg>`;

      const min = 400, max = 2000;
      const pad = 6, iw = w - pad*2, ih = h - pad*2;
      const step = iw / Math.max(1, values.length-1);
      const mapY = v => (ih - (v - min)/(max-min) * ih) + pad;
      const mapX = i => pad + i*step;

      let d = "", started = false;
      values.forEach((v,i)=>{
        if (Number.isFinite(v)){
          const x = mapX(i), y = mapY(v);
          d += (started ? " L" : " M") + x + " " + y;
          started = true;
        } else {
          started = false;
        }
      });

      return `<svg class="spark" viewBox="0 0 ${w} ${h}" preserveAspectRatio="none">\n        <path d="${d}" fill="none" stroke="${getComputedStyle(document.documentElement).getPropertyValue('--accent')||'#6ae3ff'}" stroke-width="2" stroke-linecap="round"/>\n      </svg>`;
    }

    function render(payload){
      try{
        const rows = (payload?.table?.rows || []).map(r => (r.c||[]).map(c => c ? (c.v ?? '') : ''));
        if (!rows.length){ TBODY.innerHTML = '<tr><td colspan="4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>'; return; }

        const header = rows[0];               // [name, id1, id2, ...]
        const data   = rows.slice(1);         // —É—á–∞—Å—Ç–Ω–∏–∫–∏

        const ids = header.slice(1).map((x,idx)=>{
          const s = String(x ?? '').trim();
          const ok = /^\d+$/.test(s);
          return { idx, id: ok ? Number(s) : NaN };
        }).filter(o => Number.isFinite(o.id));
        const order = ids.sort((a,b)=> a.id - b.id);
        const nPeriods = order.length;

        const recs = data.map(r => {
          const name = String(r[0]||'').trim();
          if (!name) return null;
          let prev = 400;
          const series = order.map(o => {
            const raw = r[o.idx + 1];
            const v = toNum(raw);
            if (Number.isFinite(v)) prev = v;
            return prev;
          });
          const current = series[nPeriods-1] ?? 400;
          return { name, series, current };
        }).filter(Boolean);

        recs.sort((a,b)=> b.current - a.current);

        TBODY.innerHTML = recs.map((e,idx)=>`\n          <tr>\n            <td>${idx+1}</td>\n            <td>${e.name}</td>\n            <td class=\"score\">${fmt(e.current)}</td>\n            <td>${buildSparkline(e.series)}</td>\n          </tr>`).join("") || '<tr><td colspan="4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
      }catch(e){
        console.error('[ratings] parse error', e);
        TBODY.innerHTML = '<tr><td colspan="4">–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
      }
    }

    window.google = window.google || {};
    window.google.visualization = window.google.visualization || {};
    window.google.visualization.Query = window.google.visualization.Query || {};
    window.google.visualization.Query.setResponse = render;

    function load(){
      const s = document.createElement('script');
      s.src = GVIZ_URL;
      s.async = true;
      s.onerror = () => TBODY.innerHTML = '<tr><td colspan="4">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å</td></tr>';
      document.head.appendChild(s);
      setTimeout(()=>{ if (TBODY.textContent.includes('–ó–∞–≥—Ä—É–∑–∫–∞')) TBODY.innerHTML = '<tr><td colspan="4">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å</td></tr>'; }, 8000);
    }
    document.addEventListener('DOMContentLoaded', load);
  })();
  </script>
</body>
</html>