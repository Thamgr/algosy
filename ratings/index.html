<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ê–ª–≥–æ—Å—ã ‚Äî —Ä–µ–π—Ç–∏–Ω–≥–∏</title>
  <link rel="icon" href="/algosy/static/logo.png" type="image/png" media="(prefers-color-scheme: light)">
  <link rel="icon" href="/algosy/static/logo_neg.png" type="image/png" media="(prefers-color-scheme: dark)">
  <style>
    :root{
      --bg:#0c0f14;--surface:#121621;--muted:#1a1f2b;--text:#e6e6ea;--subtle:#aab1c3;--accent:#6ae3ff;--accent-2:#9bff8a;--radius:16px;--shadow:0 8px 28px rgba(0,0,0,.35);--maxw:1100px;
    }
    body{margin:0;font-family:system-ui, sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden;}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:var(--maxw);margin:0 auto;padding:16px;}
    header{position:sticky;top:0;background:#0c0f14d9;padding:14px 16px;backdrop-filter:saturate(1.2) blur(6px);z-index:100;}
    .nav{display:flex;align-items:center;gap:16px;max-width:var(--maxw);margin:0 auto;flex-wrap:wrap;}
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;}
    .logo-badge{display:grid;place-items:center;width:36px;height:36px;border-radius:10px;background:#172033;}
    .spacer{flex:1}
    .btn{padding:8px 12px;border-radius:10px;background:var(--muted);}
    h1{margin:0 0 16px;font-size:20px;color:var(--subtle);font-weight:600}

    .panel{background:var(--surface);border-radius:var(--radius);box-shadow:var(--shadow);}
    .section-title{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,.06);color:var(--subtle);font-weight:600;}
    .body{padding:14px 18px}

    /* Responsive table styles */
    .table-container {
      width: 100%;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }
    table{width:100%;border-collapse:collapse;min-width:500px;}
    th,td{padding:16px 12px;text-align:left;}
    th{color:var(--subtle);font-weight:600;font-size:14px;border-bottom:1px solid rgba(255,255,255,.1);}
    th.sortable{cursor:pointer;user-select:none;}
    th.sortable:hover{color:var(--text);}
    th.sortable::after{content:"";margin-left:5px;opacity:0.5;}
    th.sort-asc::after{content:"‚ñ≤";opacity:1;}
    th.sort-desc::after{content:"‚ñº";opacity:1;}
    td{border-bottom:1px solid rgba(255,255,255,.05);line-height:1.4;}
    tr{min-height:50px;}
    td.score{font-variant-numeric:tabular-nums;}
    td.subscore{font-variant-numeric:tabular-nums; color:var(--subtle);}

    th:nth-child(1), td:nth-child(1) { width: 40px; }   /* # */
    th:nth-child(2), td:nth-child(2) { width: auto; }   /* –ò–º—è */
    th:nth-child(3), td:nth-child(3) { width: 80px; }   /* CF score */
    th:nth-child(4), td:nth-child(4) { width: 80px; }   /* Informatics score */
    th:nth-child(5), td:nth-child(5) {
      width: 80px;
      border-left: 1px solid rgba(255,255,255,.1);
    }   /* –û—á–∫–∏ */

    .spark { width:200px; height:40px; }
    
    /* Media queries for responsive design */
    @media (max-width: 768px) {
      .nav {
        gap: 10px;
      }
      .container {
        padding: 12px;
      }
      .body {
        padding: 12px 14px;
      }
    }
    
    @media (max-width: 480px) {
      .nav {
        justify-content: center;
      }
      .spacer {
        display: none;
      }
      .logo {
        margin-bottom: 8px;
        width: 100%;
        justify-content: center;
      }
      .btn {
        font-size: 14px;
        padding: 6px 10px;
      }
    }

    /* Info icon and tooltip styles */
    .info-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--muted);
      color: var(--subtle);
      font-size: 11px;
      font-weight: bold;
      margin-left: 4px;
      cursor: help;
      position: relative;
    }
    
    .info-icon:hover {
      background: var(--accent);
      color: var(--surface);
    }
    
    .tooltip {
      position: absolute;
      visibility: hidden;
      background: var(--muted);
      color: var(--text);
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: normal;
      white-space: nowrap;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      opacity: 0;
      transition: opacity 0.2s, visibility 0.2s;
      z-index: 10;
    }
    
    .info-icon:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }
    
    footer{color:var(--subtle);font-size:14px;padding:24px 0;text-align:center}
    
    /* Formula code styling */
    code {
      background: var(--muted);
      padding: 4px 8px;
      border-radius: 6px;
      font-family: monospace;
      font-size: 14px;
      display: inline-block;
      margin: 4px 0;
    }
    
    /* Collapsible section styling */
    .collapsible {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .collapsible::after {
      content: '‚ñº';
      font-size: 12px;
      margin-left: 8px;
      transition: transform 0.3s;
    }
    
    .collapsible.collapsed::after {
      transform: rotate(-90deg);
    }
    
    .collapsible-content {
      max-height: 500px;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    
    .collapsible-content.collapsed {
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
    }
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="logo">
        <div class="logo-badge"><span>üèÜ</span></div>
        <span>–ê–ª–≥–æ—Å—ã</span>
      </div>
      <div class="spacer"></div>
      <a class="btn" href="/algosy/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a class="btn" href="/algosy/topics/">üìö –ó–∞–Ω—è—Ç–∏—è</a>
      <a class="btn" href="/algosy/ratings/">üèÜ –†–µ–π—Ç–∏–Ω–≥–∏</a>
    </nav>
  </header>

  <main class="container">
    <h1>–†–µ–π—Ç–∏–Ω–≥-–ª–∏—Å—Ç</h1>
    <section class="panel">
      <div class="section-title collapsible collapsed">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>
      <div class="body collapsible-content collapsed">
        <p>–û—á–∫–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –≤ –∫–æ–Ω—Ç–µ—Å—Ç–∞—Ö –Ω–∞ informatics –∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ –Ω–∞ codeforces.</p>
        <p><code>score = 1000 * (0.5 * –¥–æ–ª—è —Ä–µ—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–∞ informatics + 0.5 * codeforces —Ä–µ–π—Ç–∏–Ω–≥ / 2000)</code></p>
      </div>
      <div class="section-title">–¢–∞–±–ª–∏—Ü–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞</div>
      <div class="body">
        <div class="table-container">
          <table id="ratings-table">
            <thead>
              <tr>
                <th>#</th>
                <th>–£—á–∞—Å—Ç–Ω–∏–∫</th>
                <th class="sortable" data-sort="cf_score">Codeforces</th>
                <th class="sortable" data-sort="informatics_score">Informatics</th>
                <th class="sortable sort-desc" data-sort="score">–û—á–∫–∏</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="5">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <footer>
      ¬© 2025 –ê–ª–≥–æ—Å—ã ‚Äî <a href="https://github.com/Thamgr/algosy" target="_blank">GitHub</a>
    </footer>
  </main>

  <script>
  (function(){
    // Handle collapsible sections
    document.addEventListener('DOMContentLoaded', function() {
      const collapsibles = document.querySelectorAll('.collapsible');
      
      collapsibles.forEach(collapsible => {
        collapsible.addEventListener('click', function() {
          this.classList.toggle('collapsed');
          const content = this.nextElementSibling;
          if (content.classList.contains('collapsible-content')) {
            content.classList.toggle('collapsed');
          }
        });
      });
    });
    
    // Current sort state
    let currentSort = {
      column: 'score',
      direction: 'desc'
    };
    
    // API URL - direct access without CORS proxy
    const API_URL = "https://algosy-backend-proxy.vercel.app/api/proxy/ratings?type=list&mode=full";
    
    const TBODY = document.querySelector('#ratings-table tbody');

    const fmt = n => Number.isFinite(n) ? (Math.abs(n - Math.round(n)) < 1e-6 ? String(Math.round(n)) : n.toFixed(1)) : '‚Äî';

    function buildEmptySparkline(w=100, h=48){
      return `<svg class="spark" viewBox="0 0 ${w} ${h}"></svg>`;
    }

    // No fallback data - we'll only use the API

    async function fetchRatings() {
      TBODY.innerHTML = '<tr><td colspan="5">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</td></tr>';
        
        // Direct API call without proxy
        try {
          const response = await fetch(API_URL);
          if (response.ok) {
            const data = await response.json();
            renderRatings(data);
            return;
          }
        } catch (error) {
          console.log('[ratings] API fetch failed', error);
        }
        
        // If fail, show error
        console.log('[ratings] All fetch methods failed');
        TBODY.innerHTML = '<tr><td colspan="5">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å</td></tr>';
    }

    // Sort table by column
    function sortTable(column) {
      // If clicking the same column, toggle direction
      if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
      } else {
        // New column, set to descending by default
        currentSort.column = column;
        currentSort.direction = 'desc';
      }
      
      // Update header classes
      const headers = document.querySelectorAll('th.sortable');
      headers.forEach(header => {
        header.classList.remove('sort-asc', 'sort-desc');
        if (header.dataset.sort === currentSort.column) {
          header.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
        }
      });
      
      // Re-render with current data
      if (window.currentRatingsData) {
        renderRatings(window.currentRatingsData);
      }
    }
    
    // Set up sort handlers
    document.addEventListener('DOMContentLoaded', function() {
      const sortableHeaders = document.querySelectorAll('th.sortable');
      sortableHeaders.forEach(header => {
        header.addEventListener('click', function() {
          sortTable(this.dataset.sort);
        });
      });
    });

    function renderRatings(data) {
      try {
        if (!data || Object.keys(data).length === 0) {
          TBODY.innerHTML = '<tr><td colspan="5">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
          return;
        }

        // Store data for resorting
        window.currentRatingsData = data;

        // Convert data to array format for the new JSON structure
        const recs = Object.entries(data).map(([username, info]) => {
          return {
            username,
            name: info.name || username,
            cf_score: info.cf_score || 0,
            informatics_score: info.informatics_score || 0,
            score: info.score || 0
          };
        });

        // Sort by current sort column and direction
        recs.sort((a, b) => {
          const valueA = a[currentSort.column];
          const valueB = b[currentSort.column];
          
          // Handle numeric comparison
          const multiplier = currentSort.direction === 'asc' ? 1 : -1;
          return (valueA - valueB) * multiplier;
        });

        // Render table
        TBODY.innerHTML = recs.map((e, idx) => `
          <tr>
            <td>${idx+1}</td>
            <td>${e.name}</td>
            <td class="subscore">${fmt(e.cf_score)}</td>
            <td class="subscore">${fmt(e.informatics_score)}</td>
            <td class="score">${fmt(e.score)}</td>
          </tr>`).join("") || '<tr><td colspan="5">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
      } catch (e) {
        console.error('[ratings] render error', e);
        TBODY.innerHTML = '<tr><td colspan="5">–û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
      }
    }

    document.addEventListener('DOMContentLoaded', fetchRatings);
  })();
  </script>
</body>
</html>